# PCB Component Placement Configuration - MODULE-BASED LAYOUT
# ================================================================
# Organized by atopile module structure for Sync Group compatibility
# Battery (B1) is on BACK of board - doesn't conflict with front components
# ================================================================

board:
  width: 35.0   # mm - compact since battery is on back
  height: 30.0  # mm
  origin: [0.0, 0.0]

# Force-directed algorithm - tuned for DENSE packing
# Based on IPC-7351C courtyard guidelines:
#   - Standard clearance: 0.25mm
#   - Small parts (0402): 0.15mm
force_directed:
  enabled: true
  iterations: 300              # More iterations for convergence
  attraction_strength: 0.4     # Stronger attraction for grouping
  repulsion_strength: 150.0    # REDUCED for denser packing
  damping: 0.85                # Higher damping for stability
  collision_strength: 120.0    # INCREASED for faster overlap resolution
  min_clearance: 0.25          # Per IPC-7351C standard
  random_seed: 42              # For reproducibility
  auto_rotate: true            # Enable 0/90/180/270 rotation optimization
  rotation_interval: 50        # Test rotations every 50 iterations
  board_edge_margin: 0.5       # Keep components 0.5mm from edge

# ================================================================
# MODULE GROUPS - Organized by atopile module hierarchy
# ================================================================
# Each group corresponds to a module in elec/modules/
# Component designators from build output
# ================================================================

groups:
  # =============================================================
  # MCU CORE - CENTER
  # Module: RAK3172 (main component, not a separate module)
  # =============================================================
  mcu_core:
    anchor: U1
    position: [0.0, 0.0]
    layer: front
    components:
      U1:  # RAK3172 MCU
        offset: [0.0, 0.0]
        rotation: 0
        size: [14.0, 14.0]

  # =============================================================
  # POWER FILTER MODULE
  # Module: elec/modules/power_filter_module.ato:PowerFilterBlock
  # =============================================================
  power_filter:
    anchor: L2
    position: [0.0, 9.0]
    layer: front
    components:
      L2:  # l_main - main ferrite bead
        offset: [0.0, 0.0]
        rotation: 0
        size: [1.6, 0.8]
      L3:  # l_mcu - MCU rail ferrite
        offset: [-2.5, 0.0]
        rotation: 0
        size: [1.6, 0.8]
      L4:  # l_sensors - sensor rail ferrite
        offset: [2.5, 0.0]
        rotation: 0
        size: [1.6, 0.8]
      C6:  # c_bulk - 22uF battery bulk
        offset: [-5.0, 0.0]
        rotation: 0
        size: [2.2, 1.5]
      C11:  # c_vcc_1 - 4.7uF main VCC
        offset: [0.0, 2.0]
        rotation: 0
        size: [1.8, 1.0]
      C12:  # c_vcc_2 - 100nF main VCC
        offset: [2.0, 2.0]
        rotation: 0
        size: [1.0, 0.5]
      C7:  # c_mcu_1 - 100nF MCU
        offset: [-3.5, 2.0]
        rotation: 0
        size: [1.0, 0.5]
      C8:  # c_mcu_2 - 4.7uF MCU
        offset: [-5.5, 2.0]
        rotation: 0
        size: [1.8, 1.0]
      C9:  # c_sensor_1 - 100nF sensor
        offset: [4.0, 2.0]
        rotation: 0
        size: [1.0, 0.5]
      C10:  # c_sensor_2 - 100nF sensor
        offset: [5.5, 2.0]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # BATTERY - BACK LAYER
  # Component: CR2032_Holder (centered, overlaps MCU from behind)
  # =============================================================
  battery:
    anchor: B1
    position: [0.0, 0.0]
    layer: back
    components:
      B1:  # CR2032 holder
        offset: [0.0, 0.0]
        rotation: 0
        size: [26.0, 26.0]
        layer: back

  # =============================================================
  # ACCELEROMETER MODULE
  # Module: elec/modules/lis3dhtr_module.ato:LIS3DHTR_SensorBlock
  # =============================================================
  accelerometer:
    anchor: U3
    position: [-12.0, 4.0]
    layer: front
    components:
      U3:  # LIS3DHTR IC
        offset: [0.0, 0.0]
        rotation: 0
        size: [3.0, 3.0]
      C1:  # c_bulk - 10uF
        offset: [2.5, 0.5]
        rotation: 0
        size: [1.8, 1.0]
      C2:  # c_hf - 100nF
        offset: [2.5, -0.8]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # IMU MODULE
  # Module: elec/modules/qmi8658c_module.ato:QMI8658C_IMUBlock
  # =============================================================
  imu:
    anchor: U5
    position: [-12.0, -2.0]
    layer: front
    components:
      U5:  # QMI8658C IC
        offset: [0.0, 0.0]
        rotation: 0
        size: [3.0, 2.5]
      C4:  # cp1 - 100nF
        offset: [2.5, 0.3]
        rotation: 0
        size: [1.0, 0.5]
      C5:  # cp2 - 100nF
        offset: [2.5, -0.5]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # HUMIDITY SENSOR MODULE
  # Module: elec/modules/hdc2080_module.ato:HDC2080_SensorBlock
  # =============================================================
  humidity:
    anchor: U4
    position: [-12.0, -8.0]
    layer: front
    components:
      U4:  # HDC2080 IC
        offset: [0.0, 0.0]
        rotation: 0
        size: [3.0, 3.0]
      C3:  # c_bypass - 100nF
        offset: [2.5, 0.0]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # EEPROM MODULE
  # Module: elec/modules/eeprom_module.ato:EEPROM_Block
  # =============================================================
  eeprom:
    anchor: U2
    position: [-6.0, -10.0]
    layer: front
    components:
      U2:  # FT24C02A EEPROM
        offset: [0.0, 0.0]
        rotation: 0
        size: [2.9, 1.5]
      # Note: Bypass cap shares with sensor caps (C series)

  # =============================================================
  # RF MATCHING MODULE
  # Module: elec/modules/rf_matching_module.ato:RF_MatchingNetwork
  # =============================================================
  rf_matching:
    anchor: ANT1
    position: [14.0, 0.0]
    layer: front
    components:
      ANT1:  # Antenna
        offset: [0.0, 0.0]
        rotation: 0
        size: [6.0, 2.0]
      L6:  # l_series - 4.3nH matching
        offset: [-5.0, 0.0]
        rotation: 0
        size: [1.0, 0.5]
      C15:  # c_match_ant - 5.6pF
        offset: [-3.5, -1.5]
        rotation: 90
        size: [1.0, 0.5]
      L5:  # l_harmonic - 8.2nH
        offset: [-7.0, 0.0]
        rotation: 0
        size: [1.0, 0.5]
      C16:  # c_match_mcu - 5.6pF
        offset: [-8.5, -1.5]
        rotation: 90
        size: [1.0, 0.5]
      C13:  # c_harmonic - 3.3pF
        offset: [-7.0, -1.5]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # I2C BUS MODULE
  # Module: elec/modules/i2c_bus_module.ato:I2C_BusBlock
  # =============================================================
  i2c_bus:
    anchor: R1
    position: [-3.0, 10.0]
    layer: front
    components:
      R1:  # r_scl - 4.7k pull-up
        offset: [0.0, 0.0]
        rotation: 0
        size: [1.0, 0.5]
      R2:  # r_sda - 4.7k pull-up
        offset: [0.0, 1.5]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # STATUS LED MODULE
  # Module: elec/modules/status_led_module.ato:StatusLED_Block
  # =============================================================
  status_led:
    anchor: LED1
    position: [10.0, -10.0]
    layer: front
    components:
      LED1:  # Status LED
        offset: [0.0, 0.0]
        rotation: 0
        size: [1.6, 0.8]
      R3:  # r_limit - 1k
        offset: [-2.5, 0.0]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # NTC TEMPERATURE MODULE
  # Module: elec/modules/ntc_temp_module.ato:NTC_TempSensor
  # =============================================================
  ntc_temp:
    anchor: R4
    position: [8.0, -6.0]
    layer: front
    components:
      R4:  # r_fixed - 10k divider
        offset: [0.0, 0.0]
        rotation: 0
        size: [1.0, 0.5]
      R5:  # r_ntc - NTC thermistor
        offset: [0.0, -1.5]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # SWD DEBUG MODULE
  # Module: elec/modules/swd_debug_module.ato:SWD_DebugBlock
  # =============================================================
  swd_debug:
    anchor: H1
    position: [-2.0, -14.0]
    layer: front
    components:
      H1:  # SWD Header (1x5)
        offset: [0.0, 0.0]
        rotation: 0
        size: [12.7, 2.5]
      C14:  # c_nrst - 100nF bypass
        offset: [8.0, 0.0]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # ACTIVATION CIRCUIT
  # Standalone component (not a module)
  # =============================================================
  activation:
    anchor: R6
    position: [8.0, 4.0]
    layer: front
    components:
      R6:  # r_activation - 10k pull-up
        offset: [0.0, 0.0]
        rotation: 0
        size: [1.0, 0.5]

  # =============================================================
  # RESERVED
  # Standalone component (not a module)
  # =============================================================
  reserved:
    anchor: L1
    position: [12.0, -12.0]
    layer: front
    components:
      L1:  # Reserved inductor
        offset: [0.0, 0.0]
        rotation: 0
        size: [1.8, 1.0]

# ================================================================
# NETLIST CONNECTIONS - Module-aware routing priorities
# ================================================================
connections:
  # MCU to modules
  - [U1, U3, 2.0]   # MCU to accelerometer
  - [U1, U5, 2.0]   # MCU to IMU
  - [U1, U4, 1.5]   # MCU to humidity
  - [U1, U2, 1.5]   # MCU to EEPROM

  # Power filter internal
  - [L2, C6, 4.0]   # Main ferrite to bulk cap
  - [L2, C11, 3.5]  # Main ferrite to VCC cap
  - [L3, C7, 4.0]   # MCU ferrite to MCU cap
  - [L3, C8, 3.5]   # MCU ferrite to MCU bulk
  - [L4, C9, 4.0]   # Sensor ferrite to sensor cap
  - [L4, C10, 3.5]  # Sensor ferrite to sensor cap

  # Accelerometer internal
  - [U3, C1, 4.5]
  - [U3, C2, 4.5]

  # IMU internal
  - [U5, C4, 4.5]
  - [U5, C5, 4.5]

  # Humidity internal
  - [U4, C3, 4.5]

  # RF path (critical - keep tight)
  - [U1, L5, 3.5]   # MCU to RF
  - [L5, C13, 5.0]
  - [L5, L6, 5.0]
  - [L6, C15, 4.5]
  - [L6, ANT1, 4.0]
  - [C16, L5, 4.5]

  # I2C bus
  - [U1, R1, 2.5]
  - [U1, R2, 2.5]
  - [R1, R2, 4.0]

  # Status LED
  - [U1, R3, 2.0]
  - [R3, LED1, 4.5]

  # NTC
  - [U1, R4, 2.5]
  - [R4, R5, 4.5]

  # Debug
  - [U1, H1, 1.5]
  - [H1, C14, 3.5]

  # Sensor cluster (keep sensors together)
  - [U3, U5, 3.0]
  - [U5, U4, 3.0]
  - [U4, U2, 2.5]
